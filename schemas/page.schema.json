{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/page.schema.json",
  "title": "Portfolio Page Schema",
  "type": "object",
  "required": ["meta", "body"],
  "properties": {
    "meta": { "$ref": "#/$defs/meta" },
    "presentation": { "$ref": "#/$defs/presentation" },
    "header": { "$ref": "#/$defs/header" },
    "body": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/block" }
    },
    "footer": { "$ref": "#/$defs/footer" }
  },
  "additionalProperties": false,
  "$defs": {
    "meta": {
      "type": "object",
      "required": ["id", "title", "language"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9\\-]+$"
        },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "language": {
          "type": "string",
          "enum": ["en"]
        },
        "version": { "type": "string" },
        "lastUpdated": {
          "type": "string",
          "format": "date"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "canonical": { "type": "string" },
        "image": { "type": "string" },
        "robots": { "type": "string" },
        "social": {
          "type": "object",
          "properties": {
            "title": { "type": "string" },
            "description": { "type": "string" },
            "image": { "type": "string" },
            "type": { "type": "string" },
            "card": { "type": "string" }
          },
          "additionalProperties": false
        },
        "publishedTime": {
          "type": "string",
          "format": "date-time"
        },
        "modifiedTime": {
          "type": "string",
          "format": "date-time"
        },
        "visibility": {
          "type": "string",
          "enum": ["public", "private"]
        },
        "genSubMenus": { "type": "boolean" },
        "genRelatedPages": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "header": {
      "type": "object",
      "required": ["title"],
      "properties": {
        "title": { "type": "string" },
        "subtitle": { "type": "string" },
        "lead": { "type": "string" },
        "image": {
          "type": "object",
          "required": ["src"],
          "properties": {
            "src": { "type": "string" },
            "alt": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "blockBase": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "type": "string" },
        "id": { "type": "string" },
        "style": {
          "type": "array",
          "items": { "type": "string" }
        },
        "data": { "type": "object" }
      },
      "additionalProperties": false
    },
    "paragraphBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "paragraph" },
            "data": {
              "type": "object",
              "required": ["text"],
              "properties": {
                "text": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "headingBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "heading" },
            "data": {
              "type": "object",
              "required": ["level", "text"],
              "properties": {
                "level": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 6
                },
                "text": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "listBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "list" },
            "data": {
              "type": "object",
              "required": ["items"],
              "properties": {
                "items": {
                  "type": "array",
                  "minItems": 1,
                  "items": { "type": "string" }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "timelineBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "timeline" },
            "data": {
              "type": "object",
              "required": ["items"],
              "properties": {
                "items": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["period", "title"],
                    "properties": {
                      "period": { "type": "string" },
                      "title": { "type": "string" },
                      "description": { "type": "string" }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "linkBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "link" },
            "data": {
              "type": "object",
              "required": ["label", "url"],
              "properties": {
                "label": { "type": "string" },
                "url": { "type": "string", "format": "uri" },
                "external": { "type": "boolean" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "cardGridBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "card-grid" },
            "data": {
              "type": "object",
              "required": ["cards"],
              "properties": {
                "cards": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["title"],
                    "properties": {
                      "title": { "type": "string" },
                      "description": { "type": "string" },
                      "image": { "type": "string" },
                      "link": { "type": "string" }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "assetBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "asset" },
            "data": {
              "type": "object",
              "required": ["kind", "src"],
              "properties": {
                "kind": {
                  "type": "string",
                  "enum": ["pdf", "image", "zip", "external"]
                },
                "label": { "type": "string" },
                "src": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "formBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "form" },
            "data": {
              "type": "object",
              "required": ["provider", "endpoint", "fields"],
              "properties": {
                "provider": { "type": "string" },
                "endpoint": { "type": "string", "format": "uri" },
                "fields": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["name", "label"],
                    "properties": {
                      "name": { "type": "string" },
                      "label": { "type": "string" },
                      "type": {
                        "type": "string",
                        "enum": ["text", "email", "textarea", "tel", "url", "number"]
                      },
                      "required": { "type": "boolean" },
                      "placeholder": { "type": "string" },
                      "autocomplete": { "type": "string" },
                      "helpText": { "type": "string" },
                      "validation": {
                        "type": "object",
                        "properties": {
                          "minLength": { "type": "integer", "minimum": 0 },
                          "maxLength": { "type": "integer", "minimum": 1 },
                          "pattern": { "type": "string" },
                          "min": { "type": "number" },
                          "max": { "type": "number" },
                          "step": { "type": "number" }
                        },
                        "additionalProperties": false
                      },
                      "messages": {
                        "type": "object",
                        "properties": {
                          "required": { "type": "string" },
                          "typeMismatch": { "type": "string" },
                          "patternMismatch": { "type": "string" },
                          "tooShort": { "type": "string" },
                          "tooLong": { "type": "string" },
                          "rangeUnderflow": { "type": "string" },
                          "rangeOverflow": { "type": "string" }
                        },
                        "additionalProperties": false
                      }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "htmlContentBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "html-content" },
            "data": {
              "type": "object",
              "required": ["url"],
              "properties": {
                "url": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "mapBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "map" },
            "data": {
              "type": "object",
              "required": ["embedUrl"],
              "properties": {
                "title": { "type": "string" },
                "provider": { "type": "string" },
                "embedUrl": { "type": "string", "format": "uri" },
                "linkUrl": { "type": "string", "format": "uri" },
                "address": { "type": "string" },
                "latitude": { "type": "number" },
                "longitude": { "type": "number" },
                "height": { "type": "integer", "minimum": 220, "maximum": 900 }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "linkGroupsBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "link-groups" },
            "data": {
              "type": "object",
              "required": ["groups"],
              "properties": {
                "title": { "type": "string" },
                "columns": { "type": "integer", "minimum": 1, "maximum": 4 },
                "groups": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["title", "links"],
                    "properties": {
                      "title": { "type": "string" },
                      "links": {
                        "type": "array",
                        "minItems": 1,
                        "items": {
                          "type": "object",
                          "required": ["label", "url"],
                          "properties": {
                            "label": { "type": "string" },
                            "url": { "type": "string", "format": "uri" },
                            "external": { "type": "boolean" },
                            "icon": { "type": "string" }
                          },
                          "additionalProperties": false
                        }
                      }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "orcidBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "orcid" },
            "data": {
              "type": "object",
              "required": ["orcidId"],
              "properties": {
                "orcidId": { "type": "string" },
                "sections": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["works", "education", "employment", "peer-review", "grants", "professional-activity"]
                  }
                },
                "filters": {
                  "type": "object",
                  "properties": {
                    "workType": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "sortBy": { "type": "string" },
                    "limit": { "type": "integer", "minimum": 1 }
                  },
                  "additionalProperties": false
                },
                "displayOptions": {
                  "type": "object",
                  "properties": {
                    "showTitle": { "type": "boolean" },
                    "showAbstract": { "type": "boolean" },
                    "showDetails": {
                      "type": "string",
                      "enum": ["minimal", "summary", "full"]
                    },
                    "dateFormat": { "type": "string" },
                    "citationStyle": {
                      "type": "string",
                      "enum": ["vancouver", "ieee"]
                    },
                    "visibleWorkMetadata": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": [
                          "type",
                          "publicationDate",
                          "journalBadge",
                          "authors",
                          "journal",
                          "volume",
                          "issue",
                          "number",
                          "pages",
                          "description",
                          "identifiers",
                          "providedCitation",
                          "generatedCitation"
                        ]
                      }
                    },
                    "workMetadata": {
                      "type": "object",
                      "properties": {
                        "type": { "type": "boolean" },
                        "publicationDate": { "type": "boolean" },
                        "journalBadge": { "type": "boolean" },
                        "authors": { "type": "boolean" },
                        "journal": { "type": "boolean" },
                        "volume": { "type": "boolean" },
                        "issue": { "type": "boolean" },
                        "number": { "type": "boolean" },
                        "pages": { "type": "boolean" },
                        "description": { "type": "boolean" },
                        "identifiers": { "type": "boolean" },
                        "providedCitation": { "type": "boolean" },
                        "generatedCitation": { "type": "boolean" }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                },
                "cachedData": { "type": "object" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "block": {
      "oneOf": [
        { "$ref": "#/$defs/paragraphBlock" },
        { "$ref": "#/$defs/headingBlock" },
        { "$ref": "#/$defs/listBlock" },
        { "$ref": "#/$defs/timelineBlock" },
        { "$ref": "#/$defs/linkBlock" },
        { "$ref": "#/$defs/cardGridBlock" },
        { "$ref": "#/$defs/assetBlock" },
        { "$ref": "#/$defs/formBlock" },
        { "$ref": "#/$defs/htmlContentBlock" },
        { "$ref": "#/$defs/mapBlock" },
        { "$ref": "#/$defs/linkGroupsBlock" },
        { "$ref": "#/$defs/orcidBlock" }
      ]
    },
    "footer": {
      "type": "object",
      "properties": {
        "notes": { "type": "string" },
        "related": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    },
    "presentation": {
      "type": "object",
      "properties": {
        "template": { "type": "string" },
        "bodyClass": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_\\-\\s]*$"
        },
        "extraStyles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "extraScripts": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string" },
              {
                "type": "object",
                "required": ["src"],
                "properties": {
                  "src": { "type": "string" },
                  "module": { "type": "boolean" }
                },
                "additionalProperties": false
              }
            ]
          }
        }
      },
      "additionalProperties": false
    }
  }
}
