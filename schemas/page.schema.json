{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/page.schema.json",
  "title": "Portfolio Page Schema",
  "type": "object",
  "required": ["meta", "body"],
  "properties": {
    "meta": { "$ref": "#/$defs/meta" },
    "presentation": { "$ref": "#/$defs/presentation" },
    "header": { "$ref": "#/$defs/header" },
    "body": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/block" }
    },
    "footer": { "$ref": "#/$defs/footer" }
  },
  "additionalProperties": false,
  "$defs": {
    "meta": {
      "type": "object",
      "required": ["id", "title", "language"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9\\-]+$"
        },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "language": {
          "type": "string",
          "enum": ["en"]
        },
        "version": { "type": "string" },
        "lastUpdated": {
          "type": "string",
          "format": "date"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "canonical": { "type": "string" },
        "image": { "type": "string" },
        "robots": { "type": "string" },
        "social": {
          "type": "object",
          "properties": {
            "title": { "type": "string" },
            "description": { "type": "string" },
            "image": { "type": "string" },
            "type": { "type": "string" },
            "card": { "type": "string" }
          },
          "additionalProperties": false
        },
        "publishedTime": {
          "type": "string",
          "format": "date-time"
        },
        "modifiedTime": {
          "type": "string",
          "format": "date-time"
        },
        "visibility": {
          "type": "string",
          "enum": ["public", "private"]
        },
        "status": {
          "type": "string",
          "enum": ["draft", "published"]
        },
        "genSubMenus": { "type": "boolean" },
        "genRelatedPages": { "type": "boolean" },
        "slugFromTitle": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "header": {
      "type": "object",
      "required": ["title"],
      "properties": {
        "title": { "type": "string" },
        "subtitle": { "type": "string" },
        "lead": { "type": "string" },
        "image": {
          "type": "object",
          "required": ["src"],
          "properties": {
            "src": { "type": "string" },
            "alt": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "blockBase": {
      "type": "object",
      "required": ["type", "data"],
      "properties": {
        "type": { "type": "string" },
        "id": { "type": "string" },
        "style": {
          "type": "array",
          "items": { "type": "string" }
        },
        "data": { "type": "object" }
      },
      "additionalProperties": false
    },
    "paragraphBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "paragraph" },
            "data": {
              "type": "object",
              "required": ["text"],
              "properties": {
                "text": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "headingBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "heading" },
            "data": {
              "type": "object",
              "required": ["level", "text"],
              "properties": {
                "level": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 6
                },
                "text": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "listBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "list" },
            "data": {
              "type": "object",
              "required": ["items"],
              "properties": {
                "items": {
                  "type": "array",
                  "minItems": 1,
                  "items": { "type": "string" }
                },
                "ordered": { "type": "boolean" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "timelineBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "timeline" },
            "data": {
              "type": "object",
              "required": ["items"],
              "properties": {
                "items": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["period", "title"],
                    "properties": {
                      "period": { "type": "string" },
                      "title": { "type": "string" },
                      "description": { "type": "string" }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "linkBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "link" },
            "data": {
              "type": "object",
              "required": ["label", "url"],
              "properties": {
                "label": { "type": "string" },
                "url": {
                  "type": "string",
                  "oneOf": [
                    { "format": "uri-reference" },
                    { "pattern": "^\\{\\{basePath\\}\\}/.+" }
                  ]
                },
                "external": { "type": "boolean" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "cardGridBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "card-grid" },
            "data": {
              "type": "object",
              "required": ["cards"],
              "properties": {
                "cards": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["title"],
                    "properties": {
                      "title": { "type": "string" },
                      "description": { "type": "string" },
                      "image": { "type": "string" },
                      "link": { "type": "string" },
                      "linkLabel": { "type": "string" }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "assetBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "asset" },
            "data": {
              "type": "object",
              "required": ["kind", "src"],
              "properties": {
                "kind": {
                  "type": "string",
                  "enum": ["pdf", "image", "zip", "external"]
                },
                "label": { "type": "string" },
                "src": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "formBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "form" },
            "data": {
              "type": "object",
              "required": ["provider", "endpoint", "fields"],
              "properties": {
                "provider": { "type": "string" },
                "endpoint": { "type": "string", "format": "uri" },
                "fields": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["name", "label"],
                    "properties": {
                      "name": { "type": "string" },
                      "label": { "type": "string" },
                      "type": {
                        "type": "string",
                        "enum": ["text", "email", "textarea", "tel", "url", "number"]
                      },
                      "required": { "type": "boolean" },
                      "placeholder": { "type": "string" },
                      "autocomplete": { "type": "string" },
                      "helpText": { "type": "string" },
                      "validation": {
                        "type": "object",
                        "properties": {
                          "minLength": { "type": "integer", "minimum": 0 },
                          "maxLength": { "type": "integer", "minimum": 1 },
                          "pattern": { "type": "string" },
                          "min": { "type": "number" },
                          "max": { "type": "number" },
                          "step": { "type": "number" }
                        },
                        "additionalProperties": false
                      },
                      "messages": {
                        "type": "object",
                        "properties": {
                          "required": { "type": "string" },
                          "typeMismatch": { "type": "string" },
                          "patternMismatch": { "type": "string" },
                          "tooShort": { "type": "string" },
                          "tooLong": { "type": "string" },
                          "rangeUnderflow": { "type": "string" },
                          "rangeOverflow": { "type": "string" }
                        },
                        "additionalProperties": false
                      }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "htmlContentBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "html-content" },
            "data": {
              "type": "object",
              "required": ["url"],
              "properties": {
                "url": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "profileImageBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "enum": ["feature-image", "profile-image"] },
            "data": {
              "type": "object",
              "required": ["src"],
              "properties": {
                "src": { "type": "string" },
                "alt": { "type": "string" },
                "shape": {
                  "type": "string",
                  "enum": ["square", "rounded", "circle", "octagon", "hexagon", "diamond"]
                },
                "shadow": { "type": "boolean" },
                "loadEffect": {
                  "type": "string",
                  "enum": ["none", "slide-ltr", "slide-rtl", "slide-ttb", "slide-btt", "fade-in", "blink"]
                },
                "zoom": { "type": "boolean" },
                "size": { "type": "number", "exclusiveMinimum": 0 }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "mediaImageBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "media-image" },
            "data": {
              "type": "object",
              "required": ["src"],
              "properties": {
                "src": { "type": "string" },
                "alt": { "type": "string" },
                "caption": { "type": "string" },
                "legend": { "type": "string" },
                "zoom": { "type": "boolean" },
                "width": { "type": "number", "exclusiveMinimum": 0 }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "imageGalleryBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "image-gallery" },
            "data": {
              "type": "object",
              "required": ["images"],
              "properties": {
                "title": { "type": "string" },
                "layout": {
                  "type": "string",
                  "enum": ["masonry", "photo", "justified", "moodboard", "photomontage"]
                },
                "zoom": { "type": "boolean" },
                "carousel": { "type": "boolean" },
                "gap": { "type": "number", "exclusiveMinimum": 0 },
                "images": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["src"],
                    "properties": {
                      "src": { "type": "string" },
                      "alt": { "type": "string" },
                      "caption": { "type": "string" }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "embedBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "embed" },
            "data": {
              "type": "object",
              "required": ["src"],
              "properties": {
                "src": { "type": "string" },
                "kind": { "type": "string", "enum": ["iframe", "video"] },
                "title": { "type": "string" },
                "caption": { "type": "string" },
                "ratio": { "type": "string" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "codeBlockBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "code-block" },
            "data": {
              "type": "object",
              "required": ["code"],
              "properties": {
                "code": { "type": "string" },
                "language": { "type": "string" },
                "caption": { "type": "string" },
                "lineNumbers": { "type": "boolean" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "tableBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "table" },
            "data": {
              "type": "object",
              "required": ["rows"],
              "properties": {
                "caption": { "type": "string" },
                "compact": { "type": "boolean" },
                "headers": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "rows": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "array",
                    "items": {
                      "oneOf": [
                        { "type": "string" },
                        { "type": "number" },
                        { "type": "boolean" }
                      ]
                    }
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "contentCollectionBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "content-collection" },
            "data": {
              "type": "object",
              "required": ["source"],
              "properties": {
                "source": { "type": "string" },
                "title": { "type": "string" },
                "intro": { "type": "string" },
                "maxColumns": { "type": "integer", "minimum": 2, "maximum": 4 },
                "includeRootFiles": { "type": "boolean" },
                "publishedOnly": { "type": "boolean" },
                "enableSort": { "type": "boolean" },
                "enableFilter": { "type": "boolean" },
                "defaultSort": {
                  "type": "string",
                  "enum": ["date-desc", "date-asc", "title-asc", "title-desc"]
                },
                "excerptLength": { "type": "integer", "minimum": 80, "maximum": 420 },
                "limit": { "type": "integer", "minimum": 1 },
                "emptyMessage": { "type": "string" },
                "exclude": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "contentCarouselBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "content-carousel" },
            "data": {
              "type": "object",
              "required": ["source"],
              "properties": {
                "source": { "type": "string" },
                "title": { "type": "string" },
                "intro": { "type": "string" },
                "includeRootFiles": { "type": "boolean" },
                "publishedOnly": { "type": "boolean" },
                "defaultSort": {
                  "type": "string",
                  "enum": ["date-desc", "date-asc", "title-asc", "title-desc"]
                },
                "excerptLength": { "type": "integer", "minimum": 80, "maximum": 420 },
                "limit": { "type": "integer", "minimum": 1, "maximum": 24 },
                "cardMinWidth": { "type": "integer", "minimum": 220, "maximum": 420 },
                "viewMoreUrl": { "type": "string" },
                "viewMoreLabel": { "type": "string" },
                "emptyMessage": { "type": "string" },
                "exclude": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "mapBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "map" },
            "data": {
              "type": "object",
              "properties": {
                "title": { "type": "string" },
                "provider": { "type": "string" },
                "embedUrl": { "type": "string", "format": "uri" },
                "linkUrl": { "type": "string", "format": "uri" },
                "address": { "type": "string" },
                "latitude": { "type": "number" },
                "longitude": { "type": "number" },
                "height": { "type": "integer", "minimum": 220, "maximum": 900 }
              },
              "anyOf": [
                {
                  "required": ["embedUrl"],
                  "properties": {
                    "embedUrl": { "type": "string", "format": "uri" }
                  }
                },
                {
                  "required": ["provider", "latitude", "longitude"],
                  "properties": {
                    "provider": { "type": "string" },
                    "latitude": { "type": "number" },
                    "longitude": { "type": "number" }
                  }
                }
              ],
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "rowItemBlock": {
      "oneOf": [
        { "$ref": "#/$defs/paragraphBlock" },
        { "$ref": "#/$defs/headingBlock" },
        { "$ref": "#/$defs/listBlock" },
        { "$ref": "#/$defs/timelineBlock" },
        { "$ref": "#/$defs/linkBlock" },
        { "$ref": "#/$defs/cardGridBlock" },
        { "$ref": "#/$defs/assetBlock" },
        { "$ref": "#/$defs/formBlock" },
        { "$ref": "#/$defs/htmlContentBlock" },
        { "$ref": "#/$defs/profileImageBlock" },
        { "$ref": "#/$defs/mediaImageBlock" },
        { "$ref": "#/$defs/imageGalleryBlock" },
        { "$ref": "#/$defs/embedBlock" },
        { "$ref": "#/$defs/codeBlockBlock" },
        { "$ref": "#/$defs/tableBlock" },
        { "$ref": "#/$defs/contentCollectionBlock" },
        { "$ref": "#/$defs/contentCarouselBlock" },
        { "$ref": "#/$defs/mapBlock" },
        { "$ref": "#/$defs/layoutRowBlock" },
        { "$ref": "#/$defs/linkGroupsBlock" },
        { "$ref": "#/$defs/orcidBlock" }
      ]
    },
    "layoutRowBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "layout-row" },
            "data": {
              "type": "object",
              "properties": {
                "components": {
                  "type": "array",
                  "minItems": 1,
                  "maxItems": 6,
                  "items": { "$ref": "#/$defs/rowItemBlock" }
                },
                "rows": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["components"],
                    "properties": {
                      "components": {
                        "type": "array",
                        "minItems": 1,
                        "maxItems": 6,
                        "items": { "$ref": "#/$defs/rowItemBlock" }
                      },
                      "widths": {
                        "type": "array",
                        "minItems": 1,
                        "maxItems": 6,
                        "items": {
                          "oneOf": [
                            { "type": "number", "exclusiveMinimum": 0 },
                            { "type": "string", "pattern": "^\\s*\\d+(\\.\\d+)?\\s*%?\\s*$" }
                          ]
                        }
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "widths": {
                  "type": "array",
                  "minItems": 1,
                  "maxItems": 6,
                  "items": {
                    "oneOf": [
                      { "type": "number", "exclusiveMinimum": 0 },
                      { "type": "string", "pattern": "^\\s*\\d+(\\.\\d+)?\\s*%?\\s*$" }
                    ]
                  }
                }
              },
              "anyOf": [
                {
                  "required": ["components"],
                  "properties": {
                    "components": { "type": "array" }
                  }
                },
                {
                  "required": ["rows"],
                  "properties": {
                    "rows": { "type": "array" }
                  }
                }
              ],
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "linkGroupsBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "link-groups" },
            "data": {
              "type": "object",
              "required": ["groups"],
              "properties": {
                "title": { "type": "string" },
                "columns": { "type": "integer", "minimum": 1, "maximum": 4 },
                "groups": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["title", "links"],
                    "properties": {
                      "title": { "type": "string" },
                      "links": {
                        "type": "array",
                        "minItems": 1,
                        "items": {
                          "type": "object",
                          "required": ["label", "url"],
                          "properties": {
                            "label": { "type": "string" },
                            "url": {
                              "type": "string",
                              "oneOf": [
                                { "format": "uri-reference" },
                                { "pattern": "^\\{\\{basePath\\}\\}/.+" }
                              ]
                            },
                            "external": { "type": "boolean" },
                            "icon": { "type": "string" }
                          },
                          "additionalProperties": false
                        }
                      }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "orcidBlock": {
      "allOf": [
        { "$ref": "#/$defs/blockBase" },
        {
          "type": "object",
          "properties": {
            "type": { "const": "orcid" },
            "data": {
              "type": "object",
              "required": ["orcidId"],
              "properties": {
                "orcidId": { "type": "string" },
                "sections": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["works", "education", "employment", "peer-review", "grants", "professional-activity"]
                  }
                },
                "filters": {
                  "type": "object",
                  "properties": {
                    "workType": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "sortBy": { "type": "string" },
                    "limit": { "type": "integer", "minimum": 1 }
                  },
                  "additionalProperties": false
                },
                "displayOptions": {
                  "type": "object",
                  "properties": {
                    "showTitle": { "type": "boolean" },
                    "showAbstract": { "type": "boolean" },
                    "showDetails": {
                      "type": "string",
                      "enum": ["minimal", "summary", "full"]
                    },
                    "dateFormat": { "type": "string" },
                    "citationStyle": {
                      "type": "string",
                      "enum": ["vancouver", "ieee"]
                    },
                    "visibleWorkMetadata": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": [
                          "type",
                          "publicationDate",
                          "journalBadge",
                          "authors",
                          "journal",
                          "volume",
                          "issue",
                          "number",
                          "pages",
                          "description",
                          "identifiers",
                          "providedCitation",
                          "generatedCitation"
                        ]
                      }
                    },
                    "workMetadata": {
                      "type": "object",
                      "properties": {
                        "type": { "type": "boolean" },
                        "publicationDate": { "type": "boolean" },
                        "journalBadge": { "type": "boolean" },
                        "authors": { "type": "boolean" },
                        "journal": { "type": "boolean" },
                        "volume": { "type": "boolean" },
                        "issue": { "type": "boolean" },
                        "number": { "type": "boolean" },
                        "pages": { "type": "boolean" },
                        "description": { "type": "boolean" },
                        "identifiers": { "type": "boolean" },
                        "providedCitation": { "type": "boolean" },
                        "generatedCitation": { "type": "boolean" }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                },
                "cachedData": { "type": "object" }
              },
              "additionalProperties": false
            }
          }
        }
      ]
    },
    "block": {
      "oneOf": [
        { "$ref": "#/$defs/paragraphBlock" },
        { "$ref": "#/$defs/headingBlock" },
        { "$ref": "#/$defs/listBlock" },
        { "$ref": "#/$defs/timelineBlock" },
        { "$ref": "#/$defs/linkBlock" },
        { "$ref": "#/$defs/cardGridBlock" },
        { "$ref": "#/$defs/assetBlock" },
        { "$ref": "#/$defs/formBlock" },
        { "$ref": "#/$defs/htmlContentBlock" },
        { "$ref": "#/$defs/profileImageBlock" },
        { "$ref": "#/$defs/mediaImageBlock" },
        { "$ref": "#/$defs/imageGalleryBlock" },
        { "$ref": "#/$defs/embedBlock" },
        { "$ref": "#/$defs/codeBlockBlock" },
        { "$ref": "#/$defs/tableBlock" },
        { "$ref": "#/$defs/contentCollectionBlock" },
        { "$ref": "#/$defs/contentCarouselBlock" },
        { "$ref": "#/$defs/mapBlock" },
        { "$ref": "#/$defs/layoutRowBlock" },
        { "$ref": "#/$defs/linkGroupsBlock" },
        { "$ref": "#/$defs/orcidBlock" }
      ]
    },
    "footer": {
      "type": "object",
      "properties": {
        "notes": { "type": "string" },
        "related": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    },
    "presentation": {
      "type": "object",
      "properties": {
        "template": { "type": "string" },
        "bodyClass": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_\\-\\s]*$"
        },
        "extraStyles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "extraScripts": {
          "type": "array",
          "items": {
            "oneOf": [
              { "type": "string" },
              {
                "type": "object",
                "required": ["src"],
                "properties": {
                  "src": { "type": "string" },
                  "module": { "type": "boolean" }
                },
                "additionalProperties": false
              }
            ]
          }
        }
      },
      "additionalProperties": false
    }
  }
}
